<!DOCTYPE html>

<head>
	<title>James Mernin Assignment 2</title>
    <meta charset="UTF-8">
	<link rel="stylesheet" type="text/css" href="style.css" />

	<script>
        function doMapChat() {
        	var myCoords = getCoords();
        	sendLoc(myCoords);
        	getMap(myCoords);
        };

		function getCoords() {
			if (navigator.geolocation) {
		    myCoords = navigator.geolocation.getCurrentPosition(success).coords;
		    return myCoords;
			};
			else {
				alert("Geolocation is not supported.");
			};
		};

		function success(myPos) {
			var crd = myPos.coords;
		    console.log('Latitude: ' + crd.latitude);
		    console.log('Longitude: ' + crd.longitude);
		};

		function sendLoc(crd) {
			var xhr = new XMLHttpRequest();
			var url = "https://secret-about-box.herokuapp.com/sendLocation";
			var params = "login=KeithRumfelt&lat=" + crd.latitude + "&lng=" + crd.longitude + "&message=Here I am!";

			xhr.open("POST", url, true);
			xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

			xhr.onreadystatechange = function() {
		    	if (xhr.readyState == 4 && xhr.status == 200) {
		    		alert(xhr.responseText);
		    	};
		    };

		    xhr.send(params);
		};

		function getMap(myCoords) {
			var me = new google.maps.LatLng(myCoords.latitude, myCoords.longitude);
			myOptions = {
				zoom: 13,
				center: me,
				mapTypeId: google.maps.MapTypeId.ROADMAP
			};
			map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

			map.panTo(me);

			marker = new google.maps.Marker({
				position: me,
				title: "Here I am!"
			});
			marker.setMap(map);

			var infoWindow = new google.maps.InfoWindow();

			google.maps.event.addListener(marker, 'click', function(){
				infoWindow.setContent(marker.title);
				infoWindow.open(map, marker);
			});
		};
	</script>

</head>

<body onload="doMapChat()">
	<div id="map_canvas"></div>
</body>

</html>